<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Library Dashboard for iPad</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .card-body {
      overflow: hidden;
      max-height: 300px;
      -webkit-overflow-scrolling: touch;
    }

    .card-title {
      word-wrap: break-word;
      overflow-wrap: break-word;
      white-space: normal;
    }

    .event-title {
      word-wrap: break-word;
      overflow-wrap: break-word;
      white-space: normal;
    }
    
    /* Media Queries for iPad */
    @media (max-width: 1024px) {
      body {
        font-size: 14px;
      }
      .card-body {
        max-height: 250px;
      }
      .card-title {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body class="bg-teal-500 text-white min-h-screen flex flex-col">

  <!-- Navbar -->
  <div class="navbar bg-transparent text-white mb-6 p-4">
    <div class="flex-1 text-xl">
      <span class="font-extrabold">Paraparaumu Library Schedule</span>
    </div>
    <div class="px-4 text-sm">
      <span id="current-date"></span>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container mx-auto px-6 flex-1">
    <div id="rooms" class="grid gap-6 sm:grid-cols-1 md:grid-cols-1 lg:grid-cols-1">
      <!-- Cards will be dynamically inserted here -->
    </div>
  </div>

  <!-- Modal for event details -->
  <input type="checkbox" id="event-modal" class="modal-toggle"/>
  <div class="modal">
    <div class="modal-box bg-white text-gray-800 relative">
      <label for="event-modal" class="btn btn-sm btn-circle absolute right-2 top-2">âœ•</label>
      <h3 id="modal-summary" class="font-bold text-xl mb-2"></h3>
      <p id="modal-time" class="mb-2"></p>
      <p id="modal-location" class="mb-2"></p>
      <div id="modal-description" class="whitespace-pre-wrap text-sm"></div>
    </div>
  </div>

  <script>
    // === CONFIG ===
    const API_KEY = 'YOUR_API_KEY';
    const calendars = [
      { id: 'paraparaumumake@gmail.com', name: 'Shared space' },
      { id: '99cb749e0421c837039bebfa2773ec2b696f4cbb5c8e1db0a27f071c38e871be@group.calendar.google.com', name: 'Makerspace' }
      // Add more calendars if needed
    ];

    // === HEADER DATE ===
    document.getElementById('current-date').textContent =
      new Date().toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

    // === HELPERS ===
    const formatTime = ds => new Date(ds).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    // Fetch events for today
    async function fetchEventsForToday(id) {
      const now     = new Date();
      const timeMin = new Date(now.setHours(0,0,0,0)).toISOString();
      const timeMax = new Date(now.setHours(23,59,59,999)).toISOString();
      const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(id)}/events`
                + `?key=${API_KEY}`
                + `&timeMin=${timeMin}&timeMax=${timeMax}`
                + `&singleEvents=true&orderBy=startTime`;
      const res = await fetch(url);
      return (await res.json()).items || [];
    }

    // === RENDER ===
    async function init() {
      const container = document.getElementById('rooms');
      let allEvents = [];

      // Fetch events for each calendar (for today)
      for (const cal of calendars) {
        const card = document.createElement('div');
        card.className = 'card bg-white shadow-xl border-2 border-teal-300 rounded-lg hover:shadow-2xl transition-all duration-300 ease-in-out';
        container.appendChild(card);

        const events = await fetchEventsForToday(cal.id);
        allEvents = allEvents.concat(events);

        const body = document.createElement('div');
        body.className = 'card-body p-6';
        card.appendChild(body);

        body.innerHTML = `
          <h2 class="card-title mb-2 text-black">
            ${cal.name}
            <span class="badge badge-info">${events.length} ${events.length === 1 ? 'event' : 'events'}</span>
          </h2>
          <div class="divider"></div>
        `;

        if (events.length === 0) {
          const p = document.createElement('p');
          p.className = 'text-gray-500 text-center py-4';
          p.textContent = 'No events today';
          body.appendChild(p);
        } else {
          const table = document.createElement('table');
          table.className = 'table w-full';
          table.innerHTML = `
            <thead>
              <tr>
                <th class="text-sm font-semibold text-black">Event</th>
                <th class="text-sm font-semibold text-black">Time</th>
              </tr>
            </thead>
          `;
          const tbody = document.createElement('tbody');

          events.forEach(e => {
            const start = formatTime(e.start.dateTime || e.start.date);
            const end   = formatTime(e.end.dateTime || e.end.date);
            const row = document.createElement('tr');
            row.className = 'hover:bg-teal-50 cursor-pointer';
            row.innerHTML = `
              <td class="event-title text-sm text-black">${e.summary}</td>
              <td class="text-sm font-semibold text-black">${start} - ${end}</td>
            `;
            row.addEventListener('click', () => {
              document.getElementById('modal-summary').textContent    = e.summary || 'No title';
              document.getElementById('modal-time')  .textContent    = `${start} - ${end}`;
              document.getElementById('modal-location').textContent  = e.location || 'No location specified';
              document.getElementById('modal-description').innerHTML = e.description || '<p>No description provided</p>';
              document.getElementById('event-modal').checked = true;
            });
            tbody.appendChild(row);
          });

          table.appendChild(tbody);
          body.appendChild(table);
        }
      }
    }

    init();
  </script>
</body>
</html>

