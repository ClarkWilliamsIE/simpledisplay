<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Library ‚ÄúWhat‚Äôs On - Paraparaumu Library‚Äù Display</title>

  <!-- Tailwind + DaisyUI via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@2.51.5/dist/full.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-r from-teal-400 via-teal-500 to-teal-600 text-white min-h-screen flex flex-col">

  <!-- Navbar with current date -->
  <div class="navbar bg-transparent text-white mb-6">
    <div class="flex-1 px-6">
      <span class="text-3xl font-extrabold">üìÖ Library Schedule</span>
    </div>
    <div class="px-6">
      <span id="current-date" class="text-lg"></span>
    </div>
  </div>

  <!-- Main Content (Two Columns) -->
  <div class="max-w-7xl mx-auto px-6 flex-1 grid grid-cols-1 lg:grid-cols-2 gap-6">

    <!-- "What's On Today" Section -->
    <div id="today" class="space-y-4">
      <h2 class="text-2xl font-bold text-teal-500">What's On Today</h2>
      <div id="today-rooms"></div>
    </div>

    <!-- "What's On This Week" Section -->
    <div id="this-week" class="space-y-4">
      <h2 class="text-2xl font-bold text-teal-500">What's On This Week</h2>
      <div id="this-week-rooms"></div>
    </div>

  </div>

  <script>
    // === CONFIG ===
    const API_KEY = 'AIzaSyD2qBhlb_rQHGh3kJ_ENFrxsRoFFmfrX8A';
    const calendars = [
      { id: 'paraparaumumake@gmail.com',                  name: 'Shared space' },
      { id: '99cb749e0421c837039bebfa2773ec2b696f4cbb5c8e1db0a27f071c38e871be@group.calendar.google.com', name: 'Makerspace' },
      { id: 'b952fc7ae8ea23d6f8648ee78ec4bbe830ecd5aa55266eb5a715bbcd3129718a@group.calendar.google.com', name: 'Discussion' },
      { id: '9d751487e4a33f27971ca1b54bd27d82b56d39278aabd6bcb562c431979396a2@group.calendar.google.com', name: 'Learning Centre' },
      { id: 'bf9774fd9a1f9cf44aff3d1ee97ef2a5e30789ef17f99ba846c3a780850f7e7a@group.calendar.google.com', name: 'Tamariki' },
      { id: '583fc72e7af8b504711782c092a5e3c8ea73eda4d2e4d87128c0e78d471be68c@group.calendar.google.com', name: 'Tech Lab' },
    ];

    // === HEADER DATE ===
    document.getElementById('current-date').textContent =
      new Date().toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

    // === HELPERS ===
    const formatTime = ds => new Date(ds).toLocaleTimeString([], {
      hour: '2-digit', minute: '2-digit'
    });

    async function fetchEvents(id, timeMin, timeMax) {
      const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(id)}/events` +
                  `?key=${API_KEY}` +
                  `&timeMin=${timeMin}&timeMax=${timeMax}` +
                  `&singleEvents=true&orderBy=startTime`;
      const res = await fetch(url);
      return (await res.json()).items || [];
    }

    // === DATE RANGE FOR THIS WEEK ===
    function getStartAndEndOfWeek() {
      const now = new Date();
      const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay())).setHours(0, 0, 0, 0);
      const endOfWeek = new Date(now.setDate(now.getDate() + 6)).setHours(23, 59, 59, 999);
      return [startOfWeek, endOfWeek];
    }

    // === RENDER ===
    async function init() {
      const todayContainer = document.getElementById('today-rooms');
      const thisWeekContainer = document.getElementById('this-week-rooms');

      // Fetch Today's Events
      const todayStart = new Date().toISOString().split('T')[0] + "T00:00:00Z";
      const todayEnd = new Date().toISOString().split('T')[0] + "T23:59:59Z";
      
      for (const cal of calendars) {
        const card = document.createElement('div');
        card.className = 'card bg-white shadow-xl border-2 border-teal-300 rounded-lg hover:shadow-2xl transition-all duration-300 ease-in-out';

        // Loading state
        card.innerHTML = `
          <div class="card-body p-6">
            <h2 class="card-title text-xl font-bold mb-4 text-teal-500">${cal.name} <span class="badge badge-accent">Loading</span></h2>
            <div class="flex justify-center py-4">
              <span class="loading loading-spinner loading-lg"></span>
            </div>
          </div>
        `;
        todayContainer.appendChild(card);

        // Fetch & Render Events for Today
        const eventsToday = await fetchEvents(cal.id, todayStart, todayEnd);
        const todayBody = card.querySelector('.card-body');
        todayBody.innerHTML = `
          <h2 class="card-title mb-2 text-teal-500">
            ${cal.name}
            <span class="badge badge-info">${eventsToday.length} ${eventsToday.length===1?'event':'events'}</span>
          </h2>
          <div class="divider"></div>
          ${eventsToday.length === 0
            ? `<p class="text-gray-500 text-center py-4">No events today</p>`
            : `<table class="table w-full">
                 <thead>
                   <tr>
                     <th class="text-sm font-semibold">Event</th>
                     <th class="text-sm font-semibold">Time</th>
                   </tr>
                 </thead>
                 <tbody>
                   ${eventsToday.map(e => {
                     const start = formatTime(e.start.dateTime || e.start.date);
                     const end   = formatTime(e.end.dateTime   || e.end.date);
                     return `
                       <tr class="hover:bg-teal-50">
                         <td class="text-sm text-teal-600">${e.summary}</td>
                         <td class="text-sm text-indigo-600 font-semibold">${start}‚Äì${end}</td>
                       </tr>
                     `;
                   }).join('')}
                 </tbody>
               </table>`
          }
        `;

        // Fetch & Render Events for This Week
        const [startOfWeek, endOfWeek] = getStartAndEndOfWeek();
        const weekStart = new Date(startOfWeek).toISOString();
        const weekEnd = new Date(endOfWeek).toISOString();

        const eventsThisWeek = await fetchEvents(cal.id, weekStart, weekEnd);
        const thisWeekBody = card.cloneNode(true).querySelector('.card-body');
        thisWeekBody.innerHTML = `
          <h2 class="card-title mb-2 text-teal-500">
            ${cal.name}
            <span class="badge badge-info">${eventsThisWeek.length} ${eventsThisWeek.length===1?'event':'events'}</span>
          </h2>
          <div class="divider"></div>
          ${eventsThisWeek.length === 0
            ? `<p class="text-gray-500 text-center py-4">No events this week</p>`
            : `<table class="table w-full">
                 <thead>
                   <tr>
                     <th class="text-sm font-semibold">Event</th>
                     <th class="text-sm font-semibold">Time</th>
                   </tr>
                 </thead>
                 <tbody>
                   ${eventsThisWeek.map(e => {
                     const start = formatTime(e.start.dateTime || e.start.date);
                     const end   = formatTime(e.end.dateTime   || e.end.date);
                     return `
                       <tr class="hover:bg-teal-50">
                         <td class="text-sm text-teal-600">${e.summary}</td>
                         <td class="text-sm text-indigo-600 font-semibold">${start}‚Äì${end}</td>
                       </tr>
                     `;
                   }).join('')}
                 </tbody>
               </table>`
          }
        `;
        thisWeekContainer.appendChild(card);
      }
    }

    init();
  </script>
</body>
</html>



