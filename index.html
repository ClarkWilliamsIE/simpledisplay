<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Paraparaumu Library Schedule</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.83/dist/themes/light.css" />
  <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.83/dist/shoelace.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #00b4d8, #0077b6);
      color: #fff;
    }
    .container {
      padding: 2rem;
      max-width: 1200px;
      margin: auto;
    }
    .title-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
    }
    sl-card::part(base) {
      background: #ffffff;
      color: #000;
      height: 100%;
    }
    .event-table td {
      padding: 0.4rem 0;
      border-bottom: 1px solid #ddd;
    }
    sl-dialog::part(panel) {
      max-width: 600px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="title-bar">
      <h1>Paraparaumu Library Schedule</h1>
      <div id="current-date"></div>
    </div>

    <div id="rooms" class="grid"></div>

    <sl-dialog label="Event Details" id="event-modal">
      <strong id="modal-summary"></strong>
      <div class="modal-details">
        <p><strong>Time:</strong> <span id="modal-time"></span></p>
        <p><strong>Location:</strong> <span id="modal-location"></span></p>
        <div id="modal-description"></div>
      </div>
      <sl-button slot="footer" type="primary" onclick="document.getElementById('event-modal').hide()">Close</sl-button>
    </sl-dialog>
  </div>

  <script>
    const API_KEY = 'AIzaSyD2qBhlb_rQHGh3kJ_ENFrxsRoFFmfrX8A';
    const calendars = [
      { id: 'paraparaumumake@gmail.com', name: 'Flexi space' },
      { id: '99cb749e0421c837039bebfa2773ec2b696f4cbb5c8e1db0a27f071c38e871be@group.calendar.google.com', name: 'Makerspace' },
      { id: 'b952fc7ae8ea23d6f8648ee78ec4bbe830ecd5aa55266eb5a715bbcd3129718a@group.calendar.google.com', name: 'Ground floor lounge' },
      { id: '9d751487e4a33f27971ca1b54bd27d82b56d39278aabd6bcb562c431979396a2@group.calendar.google.com', name: 'Learning centre' },
      { id: 'bf9774fd9a1f9cf44aff3d1ee97ef2a5e30789ef17f99ba846c3a780850f7e7a@group.calendar.google.com', name: 'Tamariki space' },
      { id: '583fc72e7af8b504711782c092a5e3c8ea73eda4d2e4d87128c0e78d471be68c@group.calendar.google.com', name: 'Upstairs lounge' },
    ];

    document.getElementById('current-date').textContent =
      new Date().toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

    const formatTime = ds => new Date(ds).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    async function fetchEventsForToday(id) {
      const now = new Date();
      const timeMin = new Date(now.setHours(0, 0, 0, 0)).toISOString();
      const timeMax = new Date(now.setHours(23, 59, 59, 999)).toISOString();
      const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(id)}/events?key=${API_KEY}&timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true&orderBy=startTime`;
      const res = await fetch(url);
      return (await res.json()).items || [];
    }

    async function init() {
      const container = document.getElementById('rooms');
      for (const cal of calendars) {
        const events = await fetchEventsForToday(cal.id);

        const card = document.createElement('sl-card');
        const header = `<h3>${cal.name}</h3><p>${events.length} ${events.length === 1 ? 'event' : 'events'} today</p>`;

        const eventRows = events.length === 0
          ? '<p style="color:gray">No events today</p>'
          : `<table class="event-table">${events.map(e => {
              const start = formatTime(e.start.dateTime || e.start.date);
              const end = formatTime(e.end.dateTime || e.end.date);
              return `<tr onclick="showEventModal(${encodeURIComponent(JSON.stringify(e))})" style="cursor:pointer"><td>${e.summary}</td><td>${start} - ${end}</td></tr>`;
            }).join('')}</table>`;

        card.innerHTML = `${header}<hr/>${eventRows}`;
        container.appendChild(card);
      }
    }

    window.showEventModal = (encoded) => {
      const e = JSON.parse(decodeURIComponent(encoded));
      const start = formatTime(e.start.dateTime || e.start.date);
      const end = formatTime(e.end.dateTime || e.end.date);

      document.getElementById('modal-summary').textContent = e.summary || 'No title';
      document.getElementById('modal-time').textContent = `${start} - ${end}`;
      document.getElementById('modal-location').textContent = e.location || 'No location specified';
      document.getElementById('modal-description').innerHTML = e.description || '<p>No description provided</p>';
      document.getElementById('event-modal').show();
    };

    init();
  </script>
</body>
</html>



